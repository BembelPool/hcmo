{% load thumbnail %}

<script type="text/javascript">
function itemLoadCallbackFunction(carousel, state){
    for (var i = carousel.first; i <= carousel.last; i++) {
        // Check if the item already exists
        if (!carousel.has(i)) {
            // Add the item
            carousel.add(i, "I'm item #" + i);
        }
    }
};

jQuery(document).ready(function() {
    $('#image-list-container').jcarousel({
        itemLoadCallback: itemLoadCallbackFunction
    });
    
    $('.jcarousel-item').click(function() {
    
        var last_active = $('#image-list-container ul').find('li.active').find('img');
        var last_active_src = last_active.attr('src');
        var last_active_rel = last_active.attr('rel');
        
        last_active.attr('src', last_active_rel);
        last_active.attr('rel', last_active_src);
        
        var thumb = $(this).find('img');
        var thumb_src = thumb.attr('src');
        var thumb_rel = thumb.attr('rel');
    
        if (!$(this).hasClass('active')){
            console.log('not active');
            $(this).addClass('active');
            thumb.attr('src', thumb_rel);
            thumb.attr('rel', thumb_src);
        }
    
        var src = $(this).attr("rel");
        var img = new Image();
        $(img)
            .load(function () {
                $("#image-container").html(this);
                $(".loader").hide();
                $(this).fadeIn();
            })
            .error(function() {
            })
            .attr('width', 970)
            .attr('height', 280)
            .attr('src', src)
            .fadeIn("slow");
        // Image geladen
    });
});
</script>
<div id="image-container"></div>
<div id="image-list-container" class="jcarousel-skin-tango">
    <ul>
        {% for photo in gallery.photo_set.all %}
            <li rel="{{ photo.image.url }}"><img src="{% thumbnail photo.image 130x88 crop upscale bw %}" rel="{% thumbnail photo.image 130x88 crop upscale %}" /></li>
        {% endfor %}
    </ul>
</div>